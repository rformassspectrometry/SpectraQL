<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Query a Spectra object using MassQL — query • SpectraQL</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Query a Spectra object using MassQL — query"><meta name="description" content='The query function allows to query and subset/filter a Spectra object
using a Mass Spec Query Language
MassQL
expression.
A MassQL query is expressed in the form "QUERY &amp;lt;type of data&amp;gt; WHERE &amp;lt;condition&amp;gt; AND &amp;lt;condition&amp;gt; FILTER &amp;lt;filter&amp;gt; AND &amp;lt;filter&amp;gt;", multiple
conditions and filters can be combined with logical and operations. In
the MassQL definition, conditions subsets the data to specific spectra
while filter restricts the data within a spectrum. Note that at present
MassQL filters are not supported. Also note that MassQL queries are
interpreted case insensitive in SpectraQL.
See also the package vignette for more details.'><meta property="og:description" content='The query function allows to query and subset/filter a Spectra object
using a Mass Spec Query Language
MassQL
expression.
A MassQL query is expressed in the form "QUERY &amp;lt;type of data&amp;gt; WHERE &amp;lt;condition&amp;gt; AND &amp;lt;condition&amp;gt; FILTER &amp;lt;filter&amp;gt; AND &amp;lt;filter&amp;gt;", multiple
conditions and filters can be combined with logical and operations. In
the MassQL definition, conditions subsets the data to specific spectra
while filter restricts the data within a spectrum. Note that at present
MassQL filters are not supported. Also note that MassQL queries are
interpreted case insensitive in SpectraQL.
See also the package vignette for more details.'><meta property="og:image" content="https://rformassspectrometry.github.io/SpectraQL/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpectraQL</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/SpectraQL.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/SpectraQL/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Query a Spectra object using MassQL</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/SpectraQL/blob/main/R/Spectra.R" class="external-link"><code>R/Spectra.R</code></a></small>
      <div class="d-none name"><code>query.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>query</code> function allows to query and subset/filter a <code>Spectra</code> object
using a Mass Spec Query Language
<a href="https://mwang87.github.io/MassQueryLanguage_Documentation/" class="external-link">MassQL</a>
expression.</p>
<p>A MassQL query is expressed in the form <code>"QUERY &lt;type of data&gt; WHERE &lt;condition&gt; AND &lt;condition&gt; FILTER &lt;filter&gt; AND &lt;filter&gt;"</code>, multiple
<em>conditions</em> and <em>filters</em> can be combined with logical <em>and</em> operations. In
the MassQL definition, <em>conditions</em> subsets the data to specific spectra
while <em>filter</em> restricts the data within a spectrum. Note that at present
MassQL <em>filters</em> are not supported. Also note that MassQL queries are
interpreted case insensitive in <code>SpectraQL</code>.</p>
<p>See also the package vignette for more details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">query</span><span class="op">(</span><span class="va">x</span>, query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>The <code>Spectra</code> object to query.</p></dd>


<dt id="arg-query">query<a class="anchor" aria-label="anchor" href="#arg-query"></a></dt>
<dd><p><code>character(1)</code> with the MassQL query.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>currently ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Depending on the <code>&lt;type of data&gt;</code> part of the MassQL query.</p>
    </div>
    <div class="section level2">
    <h2 id="type-of-data">Type of data<a class="anchor" aria-label="anchor" href="#type-of-data"></a></h2>



<p>The <code>"&lt;type of data&gt;"</code> allows to define which data should be extracted from
the selected spectra. MassQL defines <em>type of data</em> being <code>"MS1DATA"</code> or
<code>"MS2DATA"</code> to retrieve data from MS1 or MS2 scans. By default peak data will
be returned, but in addition, MASSQL defines additional functions that can
be applied to modify the data or select different data to be returned. In
addition <em>SpectraQL</em> defines the special type of data <code>"*"</code> which will return
the results as a <code>Spectra</code> object. <em>SpectraQL</em> supports:</p><ul><li><p><code>"*"</code>: select all data and return the data subset as a
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object.</p></li>
<li><p><code>"MS1DATA"</code>: return the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">Spectra::peaksData()</a></code> from all selected <strong>MS1</strong>
spectra, i.e. a <code>list</code> with two column matrices with the peaks' m/z and
intensity values.</p></li>
<li><p><code>"MS2DATA"</code>: return the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">Spectra::peaksData()</a></code> from all selected <strong>MS2</strong>
spectra, i.e. a <code>list</code> with two column matrices with the peaks' m/z and
intensity values.</p></li>
<li><p><code>"scaninfo(MS1DATA)"</code>, <code>"scaninfo(MS2DATA)"</code>: return the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">Spectra::spectraData()</a></code> of all selected spectra.</p></li>
<li><p><code>"scansum(MS1DATA)"</code>, <code>"scansum(MS2DATA)"</code>: sum of the peak intensities of
the selected spectra (TIC, or XIC if combined with <code>"FILTER"</code>).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="conditions">Conditions<a class="anchor" aria-label="anchor" href="#conditions"></a></h2>



<p>Conditions define to which spectra the data set should be subsetted. A
<em>condition</em> will subset a <code>Spectra</code> object to selected spectra, but will not
(unlike <em>Filters</em>, see further below) filter peaks from a spectrum. Several
conditions can be combined with <code>"and"</code> (case insensitive). The syntax for a
condition is <code>"&lt;condition&gt; = &lt;value&gt;"</code>, e.g. <code>"MS2PROD = 144.1"</code>. Such
conditions can be further refined by additional expressions that allow for
example to define acceptable tolerances for m/z differences. <code>SpectraQL</code>
supports (case insensitive):</p><ul><li><p><code>"RTMIN"</code>: minimum retention time (in <strong>seconds</strong>).</p></li>
<li><p><code>"RTMAX"</code>: maximum retention time (in <strong>seconds</strong>).</p></li>
<li><p><code>"SCANMIN"</code>: the minimum scan number (acquisition number).</p></li>
<li><p><code>"SCANMAX"</code>: the maximum scan number (acquisition number).</p></li>
<li><p><code>"CHARGE"</code>: the charge for MS2 spectra.</p></li>
<li><p><code>"POLARITY"</code>: the polarity of the spectra (can be <code>"positive"</code>,
<code>"negative"</code>, <code>"pos"</code> or <code>"neg"</code>, case insensitive).</p></li>
<li><p><code>"MS2PROD"</code> or <code>"MS2MZ"</code>: allows to select MS2 spectra that contain a peak
with particular m/z value(s). See below for examples.</p></li>
<li><p><code>"MS2PREC"</code>: allows to select MS2 spectra with the defined precursor m/z
value(s). See below for examples.</p></li>
<li><p><code>"MS1MZ"</code>: allows to select MS1 spectra containing peak(s) with the defined
m/z value(s).</p></li>
<li><p><code>"MS2NL"</code>: allows to look for a neutral loss from precursor in MS2 spectra.</p></li>
</ul><p>All conditions involving m/z values allow to specify a mass accuracy using
the optional fields <code>"TOLERANCEMZ"</code> and <code>"TOLERANCEPPM"</code> that define the
absolute and m/z-relative acceptable difference in m/z values. One or both
fields can be attached to a <em>condition</em> such as
<code>"MS2PREC=100:TOLERANCEMZ=0.1:TOLERANCEPPM=20"</code> to select for example all
MS2 spectra with a precursor m/z equal to 100 accepting a difference of 0.1
and 20 ppm. Note that in contrast to MassQL, the default tolarance and ppm
is 0 for all calls.</p>
    </div>
    <div class="section level2">
    <h2 id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a></h2>



<p>Filters subset the data within spectra, i.e. select which peaks within
spectra should be retrieved. <em>SpectraQL</em> supports the following filters:</p><ul><li><p><code>"MS1MZ"</code>: filters MS1 spectra keeping only peaks with matching m/z values
(tolerance can be specified with <code>"TOLERANCEMZ"</code> and <code>"TOLERANCEPPM"</code> as
for conditions).</p></li>
<li><p><code>"MS2MZ"</code>: filters MS2 spectra keeping only peaks with matching m/z values
(tolerance can be specified with <code>"TOLERANCEMZ"</code> and <code>"TOLERANCEPPM"</code> as
for conditions).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Andrea Vicini, Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Read a data file with MS1 and MS2 spectra</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">msdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: S4Vectors</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: stats4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BiocGenerics</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: generics</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘generics’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     as.difftime, as.factor, as.ordered, intersect, is.element, setdiff,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     setequal, union</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘BiocGenerics’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     IQR, mad, sd, var, xtabs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Filter, Find, Map, Position, Reduce, anyDuplicated, aperm, append,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     as.data.frame, basename, cbind, colnames, dirname, do.call,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     duplicated, eval, evalq, get, grep, grepl, is.unsorted, lapply,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     mapply, match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     rank, rbind, rownames, sapply, saveRDS, table, tapply, unique,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     unsplit, which.max, which.min</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘S4Vectors’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:utils’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     findMatches</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     I, expand.grid, unname</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BiocParallel</span>
<span class="r-in"><span><span class="va">fls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"TripleTOF-SWATH"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">fls</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subset to spectra measured between 300 and 400 seconds</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE RTMIN = 300 AND RTMAX = 400"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 971 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1   300.123      2271</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2   300.395      2272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1   300.533      2273</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           1   300.654      2274</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           1   300.775      2275</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 967         1   399.277      3237</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 968         1   399.406      3238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 969         1   399.527      3239</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 970         2   399.798      3240</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 971         1   399.936      3241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select retention time [300..400] on MS level(s)  [Fri May 16 19:43:12 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To extract peaks data from MS1 or MS2 spectra use "MS1DATA" or "MS2DATA"</span></span></span>
<span class="r-in"><span><span class="co">## instead of *. Note also that queries are case-insensitive.</span></span></span>
<span class="r-in"><span><span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"query ms1data where rtmin = 300 and rtmax = 400"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pks</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of length 326</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pks</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            mz  intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 50.01534 0.06152615</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 51.01116 0.20895603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 51.94061 0.09404848</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 52.01844 2.00179029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 53.00222 0.09347252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 53.01401 0.74939591</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To select (MS2) spectra with a certain precursor m/z the MS2PREC condition</span></span></span>
<span class="r-in"><span><span class="co">## can be used. Below we extract all spectra with a precursor m/z of 99.9</span></span></span>
<span class="r-in"><span><span class="co">## accepting also a difference of 10ppm</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE MS2PREC = 99.967:TOLERANCEPPM=10"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2   884.843      7495</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with precursor m/z matching 99.967 [Fri May 16 19:43:12 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## It is also possible to specify multiple precursor m/z values:</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE MS2PREC = (99.967 OR 428.88):TOLERANCEPPM=10"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2   884.843      7495</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2   887.813      7516</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with precursor m/z matching 99.967, 428.88 [Fri May 16 19:43:12 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To select all MS1 spectra that contain a peak with a certain m/z we can</span></span></span>
<span class="r-in"><span><span class="co">## use the MS1MZ condition. Below we combine this with an absolute tolerance</span></span></span>
<span class="r-in"><span><span class="co">## using TOLERANCEMZ.</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE MS1MZ = 100:TOLERANCEMZ=1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4625 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.231         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.351         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.471         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     0.591         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     0.711         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4621         1   899.491      7598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4622         1   899.613      7599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4623         1   899.747      7600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4624         1   899.872      7601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4625         1   899.993      7602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select MS level(s) 1 [Fri May 16 19:43:12 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using MS2DATA in combination with MS1MZ will not return any spectra.</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY MS2DATA WHERE MS1MZ = 100:TOLERANCEMZ=1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of length 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## In contrast, do select MS2 spectra containing a peak with a certain m/z</span></span></span>
<span class="r-in"><span><span class="co">## we have to use the condition MS2PROD</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE MS2PROD = 100:TOLERANCEMZ=1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 260 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           2    47.183       370</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2    79.371       617</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           2    81.661       631</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           2    97.140       744</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           2    97.550       746</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 256         2   884.163      7491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 257         2   884.843      7495</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 258         2   890.443      7535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 259         2   893.072      7554</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 260         2   898.602      7591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select MS level(s) 2 [Fri May 16 19:43:14 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## MS2MZ can be used as alternative to MS2PROD</span></span></span>
<span class="r-in"><span><span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE MS2MZ = 100:TOLERANCEMZ=1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 7602 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.231         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.351         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.471         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     0.591         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     0.711         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7598         1   899.491      7598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7599         1   899.613      7599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7600         1   899.747      7600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7601         1   899.872      7601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7602         1   899.993      7602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Select MS2 spectra containing a peak with neutral loss from</span></span></span>
<span class="r-in"><span><span class="co">## precursor of 100 allowing a m/z relative ppm tolerance of 5)</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY MS2DATA WHERE MS2NL=100:TOLERANCEPPM=5"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Combine two different conditions: selection of spectra with positive</span></span></span>
<span class="r-in"><span><span class="co">## polarity and retention time greater than 200</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">query</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="st">"QUERY * WHERE RTMIN = 200 AND POLARITY = Positive"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Rainer, Andrea Vicini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.9000.</p>
</div>

    </footer></div>





  </body></html>

